---
layout: post
title: "Docker in Docker"
subtitle: "A Jenkins Adventure"
bigimg: /img/dind.gif
tags: [docker, jenkins, docker-in-docker, dind]
comments: true
draft: true
output:
  html_document:
    keep_md: true
---

Eu imagino que minha história é muito parecida com a de tantas outras pessoas trabalhando com CICD.

Você começa a montar a esteira CICD usando Jenkins, e um determinado momento vem o pensamento:

> "Por quê não executar o Jenkins em um container docker?"

E, como um raio, um segundo pessamento cai sobre você:

> "Qual docker (executável) o Jenkins vai utilizar para os *builds*?"

A partir daí, é um caminho sem volta de tentativas e de buscar alguma solução entre documentações, blogs e forúns online.

<center>
<img src="/img/tabs.gif" style="display: block; margin: auto;height: 220px;">
</center>

Independente do percurso, todos temos um mesmo checkpoint: o [artigo de Jérôme Petazzoni](http://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/) sobre Docker-in-Docker (dind, para os intimos).

De forma pratica, ao falar de dind, estamos nos referindo a um container docker com uma instalação docker que permite executar outros containers...

... que podem ser outro container docker-in-docker que pode executar outros containers...

<center>
<img src="/img/inception.gif" style="display: block; margin: auto;height: 220px;">
</center>

No artigo, temos um dos contribuidores da flag `--privileged`, essencial para a execução do dind, criticando o uso do dind para determinados cenários - inclusive para o Jenkins.

Nesse mesmo artigo, uma solução é apresentada: montar o `docker.sock` da máquina host como forma do container contendo o Jenkins executar e guardar seu cache no Docker instalado no host.

Longe, de dizer qual das duas alternativas é a "correta". Neste post, quero discutir alguns dos pontos envolvendo essas abordagens.


## TL;DR

<script src="https://gist.github.com/adelmofilho/5a30a87eaf1cd4a03052f37b516d6714.js"></script>